/**
 * Mobile Enhanced CSS - Week 6 Mobile Experience Optimization
 * Touch targets (44px minimum), keyboard avoidance, responsive layouts
 * Based on UX design specifications for mobile experience
 */

/* Enhanced mobile touch targets */
:root {
  /* Enhanced mobile touch targets */
  --touch-target-min: 44px;
  --touch-target-standard: 56px;
  --touch-target-large: 64px;

  /* Mobile spacing optimizations */
  --mobile-spacing-xs: 4px;
  --mobile-spacing-sm: 8px;
  --mobile-spacing-md: 12px;
  --mobile-spacing-lg: 16px;
  --mobile-spacing-xl: 20px;

  /* Keyboard viewport variables */
  --visual-viewport-height: 100vh;
  --visual-viewport-width: 100vw;
  --visual-viewport-offset-top: 0px;
  --keyboard-height: 0px;

  /* Mobile-specific breakpoints */
  --mobile-xs: 320px;
  --mobile-sm: 380px;
  --mobile-md: 480px;
  --mobile-lg: 600px;

  /* Touch feedback timing */
  --touch-feedback-duration: 150ms;
  --keyboard-transition-duration: 300ms;
}

/* Base mobile form container */
.transaction-form {
  display: flex;
  flex-direction: column;
  gap: var(--mobile-spacing-md);
  padding: var(--mobile-spacing-lg);
  width: 100%;
  max-width: 100%;
  /* Remove transition animation */
  /* 
    Use fixed height (100vh) instead of viewport variable (--visual-viewport-height)
    REASON: Viewport variables change when keyboard appears/disappears, causing 
    layout jumps and view shrinking on mobile. Fixed height prevents these issues.
  */
  min-height: 100vh;
}

/* Keyboard-aware form adjustments */
body.keyboard-visible .transaction-form {
  gap: var(--mobile-spacing-sm);
  padding: var(--mobile-spacing-sm);
  /* 
    Use fixed height (100vh) instead of viewport variable (--visual-viewport-height)
    REASON: Viewport variables change when keyboard appears/disappears, causing 
    layout jumps and view shrinking on mobile. Fixed height prevents these issues.
  */
  max-height: 100vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* Form sections */
.form-section {
  /* Remove transition animation */
}

body.keyboard-visible .form-section {
  margin-bottom: var(--mobile-spacing-sm);
}

/* Amount section with keyboard awareness */
.amount-section {
  /* Remove transition animation */
}

body.keyboard-visible .amount-section {
  position: sticky;
  /* 
    Use fixed top (0) instead of viewport variable (--visual-viewport-offset-top)
    REASON: Viewport variables change when keyboard appears/disappears, causing 
    layout jumps and view shrinking on mobile. Fixed positioning prevents these issues.
  */
  top: 0;
  z-index: 20;
  background: var(--color-surface);
  padding: var(--mobile-spacing-md);
  margin: 0 calc(var(--mobile-spacing-sm) * -1) var(--mobile-spacing-md);
  border-radius: var(--radius-lg);
  box-shadow: 0 4px 20px rgb(0, 0, 0, 0.3);
}

/* Smart amount input */
.smart-amount-input {
  width: 100%;
  height: var(--touch-target-large);
  font-size: 16px; /* Prevent zoom */
}

.smart-amount-input:focus {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px
    hsl(var(--primary-hue), var(--primary-sat), var(--primary-light), 0.15);
  outline: none;
}

/* Amount suggestions container */
.smart-suggestions-container {
  margin-top: var(--mobile-spacing-sm);
  padding: var(--mobile-spacing-sm);
  background: hsl(
    var(--primary-hue),
    var(--primary-sat),
    var(--primary-light),
    0.05
  );
  border-radius: var(--radius-md);
  border: 1px solid
    hsl(var(--primary-hue), var(--primary-sat), var(--primary-light), 0.2);
  /* Remove transition animation */
}

body.keyboard-visible .smart-suggestions-container {
  max-height: 120px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* Suggestion chips */
.suggestion-chips {
  display: flex;
  gap: var(--mobile-spacing-sm);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
  padding: var(--mobile-spacing-xs) 0;
  margin: 0 calc(var(--mobile-spacing-xs) * -1);
}

.suggestion-chip {
  flex-shrink: 0;
  scroll-snap-align: start;
  min-width: 70px;
  min-height: var(--touch-target-min);
  padding: var(--mobile-spacing-sm) var(--mobile-spacing-md);
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: pointer;
  /* Remove touch feedback animation */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  font-size: var(--font-size-sm);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

.suggestion-chip:active {
  /* Remove transform scale animation */
  background: hsl(
    var(--primary-hue),
    var(--primary-sat),
    var(--primary-light),
    0.1
  );
}

.suggestion-chip.selected {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

/* Category section */
.category-section {
  /* Remove transition animation */
}

body.keyboard-visible .category-section {
  /* 
    Use fixed height (40vh) instead of viewport variable (--visual-viewport-height)
    REASON: Viewport variables change when keyboard appears/disappears, causing 
    layout jumps and view shrinking on mobile. Fixed height prevents these issues.
  */
  max-height: 40vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}

/* Smart match container */
.smart-match-container {
  padding: var(--mobile-spacing-md);
  background: linear-gradient(
    135deg,
    hsl(var(--primary-hue), var(--primary-sat), var(--primary-light), 0.1),
    hsl(var(--primary-hue), var(--primary-sat), var(--primary-light), 0.05)
  );
  border: 2px solid var(--color-primary);
  border-radius: var(--radius-lg);
  margin-bottom: var(--mobile-spacing-md);
  /* Remove transition animation */
}

body.keyboard-visible .smart-match-container {
  position: sticky;
  /* 
    Use fixed top (80px) instead of viewport variable (--visual-viewport-offset-top)
    REASON: Viewport variables change when keyboard appears/disappears, causing 
    layout jumps and view shrinking on mobile. Fixed positioning prevents these issues.
  */
  top: 80px;
  z-index: 15;
  margin: 0 calc(var(--mobile-spacing-sm) * -1) var(--mobile-spacing-sm);
}

/* Category grid */
.category-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--mobile-spacing-md);
  /* Remove transition animation */
}

body.keyboard-visible .category-grid {
  gap: var(--mobile-spacing-sm);
  max-height: 200px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: var(--mobile-spacing-sm);
}

/* Category cards */
.category-card {
  min-height: 80px;
  min-width: 80px;
  padding: var(--mobile-spacing-md);
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  cursor: pointer;
  /* Remove touch feedback animation */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  gap: var(--mobile-spacing-xs);
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

body.keyboard-visible .category-card {
  min-height: 60px;
  min-width: 60px;
  padding: var(--mobile-spacing-sm);
}

.category-card:active {
  /* Remove transform scale animation */
  background: var(--color-surface-hover);
}

.category-card.selected {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

/* Note section */
.note-section {
  /* Remove transition animation */
}

body.keyboard-visible .note-section {
  margin-bottom: var(--mobile-spacing-sm);
}

/* Smart note input */
.smart-note-input {
  width: 100%;
  min-height: var(--touch-target-min);
  max-height: 120px;
  padding: var(--mobile-spacing-md);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-surface);
  color: var(--color-text-main);
  font-size: 16px; /* Prevent zoom */
  line-height: 1.4;
  resize: none;
  /* Remove transition animation */
}

body.keyboard-visible .smart-note-input {
  min-height: 60px;
  max-height: 80px;
}

/* Form actions */
.form-actions {
  display: flex;
  gap: var(--mobile-spacing-md);
  /* Remove transition animation */
}

body.keyboard-visible .form-actions {
  /* Keep actions accessible with keyboard */
  position: sticky;
  /* 
    Use fixed bottom (0) instead of keyboard height variable (--keyboard-height)
    REASON: Keyboard height variables change dynamically, causing 
    layout jumps and view shrinking on mobile. Fixed positioning prevents these issues.
  */
  bottom: 0;
  background: var(--color-surface);
  padding: var(--mobile-spacing-md);
  border-top: 1px solid var(--color-border);
  z-index: 25;
  margin: 0 calc(var(--mobile-spacing-sm) * -1)
    calc(var(--mobile-spacing-sm) * -1);
  max-height: 120px; /* Prevent oversized action area */
  overflow: hidden;
}

/* Primary action button - more conservative sizing */
.mobile-btn-primary {
  flex: 1;
  min-height: var(--touch-target-standard);
  max-height: 80px; /* Prevent oversized buttons */
  padding: var(--mobile-spacing-md) var(--mobile-spacing-lg);
  background: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--radius-lg);
  font-size: 16px; /* Prevent zoom */
  font-weight: 600;
  cursor: pointer;
  /* Remove transition animation */
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  /* Ensure button doesn't exceed viewport */
  width: 100%;
  box-sizing: border-box;
}

/* Remove active state animation */

/* Touch target classes */
.touch-target-primary {
  min-width: var(--touch-target-standard);
  min-height: var(--touch-target-standard);
  padding: var(--mobile-spacing-md) var(--mobile-spacing-lg);
  margin: var(--mobile-spacing-sm);
  border-radius: var(--radius-lg);
  /* Remove transition animation */
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}

.touch-target-secondary {
  min-width: var(--touch-target-min);
  min-height: var(--touch-target-min);
  padding: var(--mobile-spacing-sm) var(--mobile-spacing-md);
  margin: var(--mobile-spacing-xs);
  border-radius: var(--radius-md);
  /* Remove transition animation */
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
  user-select: none;
}

/* Remove touch feedback animation */

/* Keyboard visibility states */
body {
  --keyboard-height: 0px;
  --visual-viewport-height: 100vh;
  --visual-viewport-offset-top: 0px;
  /* Remove transition animation */
}

body.keyboard-visible {
  height: var(--visual-viewport-height);
  overflow: hidden;
}

body.keyboard-hidden {
  height: 100vh;
  overflow: auto;
}

/* Input-specific keyboard behaviors */
body.input-focused {
  /* General input focused state */
}

body.input-text-focused {
  /* Text input specific behaviors */
}

body.input-number-focused {
  /* Number input specific behaviors */
}

body.input-search-focused {
  /* Search input specific behaviors */
}

/* Responsive breakpoints */
@media (width <= 379px) {
  .transaction-form {
    padding: var(--mobile-spacing-sm);
    gap: var(--mobile-spacing-sm);
  }

  .suggestion-chip {
    min-width: 60px;
    min-height: 40px;
    padding: var(--mobile-spacing-xs) var(--mobile-spacing-sm);
    font-size: 12px;
  }

  .category-card {
    min-width: 60px;
    min-height: 60px;
    padding: var(--mobile-spacing-sm);
  }

  .category-grid {
    gap: var(--mobile-spacing-xs);
  }

  .smart-amount-input {
    height: var(--touch-target-min);
  }

  .mobile-btn-primary {
    min-height: var(--touch-target-min);
    max-height: 60px; /* Even smaller on very small screens */
    padding: var(--mobile-spacing-sm) var(--mobile-spacing-md);
    font-size: 14px; /* Smaller font on small screens */
  }
}

@media (width >= 380px) and (width <= 479px) {
  .category-grid {
    grid-template-columns: repeat(3, 1fr);
  }

  .suggestion-chip {
    min-width: 75px;
    min-height: var(--touch-target-min);
  }

  .category-card {
    min-width: 75px;
    min-height: 75px;
  }
}

@media (width >= 480px) and (width <= 767px) {
  .transaction-form {
    max-width: 600px;
    margin: 0 auto;
    padding: var(--mobile-spacing-lg);
  }

  .category-grid {
    grid-template-columns: repeat(4, 1fr);
    gap: var(--mobile-spacing-md);
  }

  .suggestion-chip {
    min-width: 80px;
    min-height: var(--touch-target-standard);
  }

  .category-card {
    min-width: 80px;
    min-height: 80px;
    padding: var(--mobile-spacing-md);
  }

  .smart-amount-input {
    height: var(--touch-target-large);
  }

  .mobile-btn-primary {
    min-height: var(--touch-target-large);
    padding: var(--mobile-spacing-md) var(--mobile-spacing-xl);
  }
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .smart-amount-input,
  .smart-note-input {
    background-color: hsl(var(--bg-hue), var(--bg-sat), var(--bg-light), 0.1);
    border-color: hsl(
      var(--border-hue),
      var(--border-sat),
      var(--border-light),
      0.3
    );
    color: var(--color-text-main);
  }

  .suggestion-chip,
  .category-card {
    background-color: hsl(var(--bg-hue), var(--bg-sat), var(--bg-light), 0.1);
    border-color: hsl(
      var(--border-hue),
      var(--border-sat),
      var(--border-light),
      0.3
    );
  }

  .suggestion-chip.selected,
  .category-card.selected {
    color: white;
  }
}

/* High contrast mode */
@media (prefers-contrast: high) {
  .smart-amount-input,
  .smart-note-input {
    border-width: 2px;
  }

  .suggestion-chip,
  .category-card {
    border-width: 2px;
  }

  .category-card.selected {
    border-color: black;
    color: black;
    background: white;
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .suggestion-chip,
  .category-card,
  .smart-amount-input,
  .smart-note-input,
  .mobile-btn-primary {
    transition: none;
  }

  .suggestion-chip:hover,
  .category-card:hover {
    transform: none;
  }

  body.keyboard-visible .transaction-form,
  body.keyboard-visible .form-section,
  body.keyboard-visible .smart-suggestions-container,
  body.keyboard-visible .smart-match-container,
  body.keyboard-visible .category-grid {
    transition: none;
  }
}
